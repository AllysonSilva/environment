##############
#### TLS Best Practices
##############

# Increase TLS Session Duration.
# Enable session resumption to improve https performance.
# Improve HTTPS performance with session resumption.
ssl_session_timeout 1d;
ssl_session_cache shared:SSL:50m;
ssl_session_tickets off;

# Disable SSL and only Enable TLS in Nginx.
#
# The latest version of the Transport Layer Security (TLS) protocol.
# Allows for data/message confidentiality, and message authentication codes for message integrity and as a by-product message authentication.
ssl_protocols TLSv1.2;

# Enable Strong TLS Ciphers.
ssl_ciphers EECDH+AESGCM:EECDH+AES;
# ssl_ciphers EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH;
ssl_ecdh_curve secp384r1:secp256k1;
# Enables server-side protection from BEAST attacks.
# Enforce Server-Side Cipher Suite Preferences.
ssl_prefer_server_ciphers on;

# Specifies a file with DH parameters for DHE ciphers.
#
# A Diffie-Hellman parameter is a set of randomly generated data used when establishing Perfect Forward Secrecy during initiation of an HTTPS connection.
# The default size is usually 1024 or 2048 bits, depending on the serverâ€™s OpenSSL version, but a 4096 bit key will provide greater security.
#
# $> openssl genpkey -genparam -algorithm DH -out /root/certs/allyson.tech/dhparam4096.pem -pkeyopt dh_paramgen_prime_len:4096
# $> openssl /etc/letsencrypt/dhparam -out dhparam4096.pem 4096
# $> screen -S dhparam && openssl dhparam -out /etc/ssl/certs/dhparam.pem 4096
ssl_dhparam /etc/letsencrypt/certs/dhparam4096.pem;

# Enable OCSP stapling (http://blog.mozilla.org/security/2013/07/29/ocsp-stapling-in-firefox).
# more: https://sslmate.com/blog/post/ocsp_stapling_in_apache_and_nginx
#
# Verify OCSP stapling is working properly:
#     openssl s_client -connect allyson.tech:443 -tls1 -tlsextdebug -status
ssl_stapling on;
ssl_stapling_verify on;
## Verify chain of trust of OCSP response using Root CA and Intermediate certs.
ssl_trusted_certificate /etc/letsencrypt/live/allyson.tech/fullchain.pem;
resolver 8.8.8.8 8.8.4.4 valid=60s;
resolver_timeout 5s;
